import types\nimport pytest\nfrom src.etl.orchestrator import ETLOrchestrator, ETLJob\n\n\nclass FakeAPI:\n    def __init__(self, values=None):\n        self.values = values or [{\"id\": 1}, {\"id\": 2}]\n    def get_odata(self, endpoint: str):\n        return self.values\n\n\nclass FakeLoader:\n    def __init__(self):\n        self.calls = []\n    def load_to_staging(self, table, records, job_id, run_id):\n        self.calls.append((table, len(records), job_id, run_id))\n\n\nclass FakeDB:\n    pass\n\n\ndef test_execute_simple_job_happy_path(monkeypatch):\n    api = FakeAPI()\n    loader = FakeLoader()\n    orch = ETLOrchestrator(FakeDB(), api, loader)\n\n    # monkeypatch stubs\n    monkeypatch.setattr(orch, \"_load_job_config\", lambda job_id: ETLJob(id=1, name=\"studies\", source_endpoint=\"/odata/studies\", target_table=\"dim_studies_staging\"))\n    monkeypatch.setattr(orch, \"_create_run_record\", lambda job_id: 42)\n    monkeypatch.setattr(orch, \"_update_run_record\", lambda *args, **kwargs: None)\n\n    res = orch.execute_job(1)\n\n    assert res.status == \"success\"\n    assert res.records_loaded == 2\n    assert loader.calls[0][0] == \"dim_studies_staging\"\n